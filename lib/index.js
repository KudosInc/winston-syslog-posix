var SyslogPosix, exports, posix, util, winston;

posix = require('posix');

util = require('util');

winston = require('winston');

SyslogPosix = winston.transports.SyslogPosix = function(options) {
  if (options == null) {
    options = {};
  }
  this.name = 'SyslogPosix';
  this.level = options.level || 'debug';
  this.identity = options.identity || process.title;
  this.facility = options.facility || 'local0';
  this.unmapped = options.unmapped || 'info';
  return this.showPid = options.showPid === void 0 ? true : options.showPid;
};

util.inherits(SyslogPosix, winston.Transport);

SyslogPosix.prototype.log = function(level, msg, meta, callback) {
  var maxLength, message, messages, prepend, syslogOptions, syslogSeverity;
  if (this.silent) {
    return callback(null, true);
  }
  syslogSeverity = level;
  if (level === 'trace') {
    syslogSeverity = 'debug';
  } else if (level === 'warn') {
    syslogSeverity = 'warning';
  } else if (level === 'error') {
    syslogSeverity = 'err';
  } else if (level === 'fatal') {
    syslogSeverity = 'emerg';
  } else {
    syslogSeverity = this.unmapped;
  }
  message = msg;
  prepend = '[' + level + '] ';
  if (typeof meta === 'string') {
    message += ' ' + meta;
  } else if (meta && typeof meta === 'object' && Object.keys(meta).length > 0) {
    message += ' ' + util.inspect(meta, false, null, false);
  }
  message = message.replace(/\u001b\[(\d+(;\d+)*)?m/g, '');
  messages = [];
  maxLength = 1024 - prepend.length;
  while (message.length > maxLength) {
    messages.push(prepend + message.substring(0, maxLength));
    message = message.substring(maxLength);
  }
  messages.push(prepend + message);
  syslogOptions = {
    cons: true,
    pid: this.showPid
  };
  posix.openlog(this.identity, syslogOptions, this.facility);
  messages.forEach(function(message) {
    return posix.syslog(syslogSeverity, message);
  });
  posix.closelog();
  this.emit('logged');
  return callback(null, true);
};

module.exports = exports = SyslogPosix;

//# sourceMappingURL=data:application/json;base64,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aUIsU0FBQyxPQUFEO1dBQ2YsS0FBSyxDQUFDLE1BQU4sQ0FBYSxjQUFiLEVBQTZCLE9BQTdCO0VBRGUsQ0FBakI7RUFFQSxLQUFLLENBQUMsUUFBTixDQUFBO0VBQ0EsSUFBQyxDQUFBLElBQUQsQ0FBTSxRQUFOO1NBQ0EsUUFBQSxDQUFTLElBQVQsRUFBZSxJQUFmO0FBeENpQjs7QUEwQ25CLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLE9BQUEsR0FBVSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbInBvc2l4ID0gcmVxdWlyZSAncG9zaXgnXG51dGlsID0gcmVxdWlyZSAndXRpbCdcbndpbnN0b24gPSByZXF1aXJlICd3aW5zdG9uJ1xuXG5TeXNsb2dQb3NpeCA9IHdpbnN0b24udHJhbnNwb3J0cy5TeXNsb2dQb3NpeCA9IChvcHRpb25zID0ge30pIC0+XG4gIEBuYW1lID0gJ1N5c2xvZ1Bvc2l4J1xuICBAbGV2ZWwgPSBvcHRpb25zLmxldmVsIG9yICdkZWJ1ZydcbiAgQGlkZW50aXR5ID0gb3B0aW9ucy5pZGVudGl0eSBvciBwcm9jZXNzLnRpdGxlXG4gIEBmYWNpbGl0eSA9IG9wdGlvbnMuZmFjaWxpdHkgb3IgJ2xvY2FsMCdcbiAgQHVubWFwcGVkID0gb3B0aW9ucy51bm1hcHBlZCBvciAnaW5mbydcbiAgQHNob3dQaWQgPSBpZiBvcHRpb25zLnNob3dQaWQgPT0gdW5kZWZpbmVkIHRoZW4gdHJ1ZSBlbHNlIG9wdGlvbnMuc2hvd1BpZFxuXG4jXG4jIEluaGVyaXQgZnJvbSBgd2luc3Rvbi5UcmFuc3BvcnRgIHNvIHlvdSBjYW4gdGFrZSBhZHZhbnRhZ2VcbiMgb2YgdGhlIGJhc2UgZnVuY3Rpb25hbGl0eSBhbmQgYC5oYW5kbGVFeGNlcHRpb25zKClgLlxuI1xudXRpbC5pbmhlcml0cyBTeXNsb2dQb3NpeCwgd2luc3Rvbi5UcmFuc3BvcnRcblxuU3lzbG9nUG9zaXg6OmxvZyA9IChsZXZlbCwgbXNnLCBtZXRhLCBjYWxsYmFjaykgLT5cbiAgaWYgQHNpbGVudFxuICAgIHJldHVybiBjYWxsYmFjayBudWxsLCB0cnVlXG5cbiAgIyBtYXAgY29tbW9uIGRlYnVnIGxldmVscyB0byB2YWxpZCBwb3NpeCBzeXNsb2cgdmFsdWVzXG4gIHN5c2xvZ1NldmVyaXR5ID0gbGV2ZWxcbiAgaWYgbGV2ZWwgPT0gJ3RyYWNlJ1xuICAgIHN5c2xvZ1NldmVyaXR5ID0gJ2RlYnVnJ1xuICBlbHNlIGlmIGxldmVsID09ICd3YXJuJ1xuICAgIHN5c2xvZ1NldmVyaXR5ID0gJ3dhcm5pbmcnXG4gIGVsc2UgaWYgbGV2ZWwgPT0gJ2Vycm9yJ1xuICAgIHN5c2xvZ1NldmVyaXR5ID0gJ2VycidcbiAgZWxzZSBpZiBsZXZlbCA9PSAnZmF0YWwnXG4gICAgc3lzbG9nU2V2ZXJpdHkgPSAnZW1lcmcnXG4gIGVsc2VcbiAgICBzeXNsb2dTZXZlcml0eSA9IEB1bm1hcHBlZFxuXG4gIG1lc3NhZ2UgPSBtc2dcbiAgcHJlcGVuZCA9ICdbJyArIGxldmVsICsgJ10gJ1xuICBpZiB0eXBlb2YgbWV0YSA9PSAnc3RyaW5nJ1xuICAgIG1lc3NhZ2UgKz0gJyAnICsgbWV0YVxuICBlbHNlIGlmIG1ldGEgYW5kIHR5cGVvZiBtZXRhID09ICdvYmplY3QnIGFuZCBPYmplY3Qua2V5cyhtZXRhKS5sZW5ndGggPiAwXG4gICAgbWVzc2FnZSArPSAnICcgKyB1dGlsLmluc3BlY3QobWV0YSwgZmFsc2UsIG51bGwsIGZhbHNlKVxuICBtZXNzYWdlID0gbWVzc2FnZS5yZXBsYWNlKC9cXHUwMDFiXFxbKFxcZCsoO1xcZCspKik/bS9nLCAnJylcblxuICAjIHRydW5jYXRlIG1lc3NhZ2UgdG8gYSBtYXggb2YgMTAyNCBieXRlc1xuICBtZXNzYWdlcyA9IFtdXG4gIG1heExlbmd0aCA9IDEwMjQgLSBwcmVwZW5kLmxlbmd0aFxuICB3aGlsZSBtZXNzYWdlLmxlbmd0aCA+IG1heExlbmd0aFxuICAgIG1lc3NhZ2VzLnB1c2ggcHJlcGVuZCArIG1lc3NhZ2Uuc3Vic3RyaW5nKDAsIG1heExlbmd0aClcbiAgICBtZXNzYWdlID0gbWVzc2FnZS5zdWJzdHJpbmcobWF4TGVuZ3RoKVxuICBtZXNzYWdlcy5wdXNoIHByZXBlbmQgKyBtZXNzYWdlXG4gIHN5c2xvZ09wdGlvbnMgPVxuICAgIGNvbnM6IHRydWVcbiAgICBwaWQ6IEBzaG93UGlkXG4gIHBvc2l4Lm9wZW5sb2cgQGlkZW50aXR5LCBzeXNsb2dPcHRpb25zLCBAZmFjaWxpdHlcbiAgbWVzc2FnZXMuZm9yRWFjaCAobWVzc2FnZSkgLT5cbiAgICBwb3NpeC5zeXNsb2cgc3lzbG9nU2V2ZXJpdHksIG1lc3NhZ2VcbiAgcG9zaXguY2xvc2Vsb2coKVxuICBAZW1pdCAnbG9nZ2VkJ1xuICBjYWxsYmFjayBudWxsLCB0cnVlXG5cbm1vZHVsZS5leHBvcnRzID0gZXhwb3J0cyA9IFN5c2xvZ1Bvc2l4XG4iXX0=
